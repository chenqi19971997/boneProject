"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}require(["./config"],function(){require(["template","header","footer"],function(e,t){new(function(){function t(){_classCallCheck(this,t),this.render(),this.cart&&(this.setAllCheckStatus(),this.calcTotalMoney(),this.checksChange(),this.addSubCount(),this.setCheckAll(),this.calSendPrice())}return _createClass(t,[{key:"render",value:function(){var t=localStorage.getItem("cart");t?(this.cart=JSON.parse(t),console.log(this.cart),$("#goods").html(e("goodsTemplate",{cart:this.cart})),$(".shopping_car").css("display","block"),$(".cart-empty").css("display","none")):($(".shopping_car").css("display","none"),$(".cart-empty").css("display","block")),this.addSubCount()}},{key:"calcTotalMoney",value:function(){var t=this.cart.reduce(function(t,e){return e.check&&(t+=e.price*e.count),t},0);for(var e in $("#totalPrice1").html(t.toFixed(2)),$("#totalPrice2").html(t.toFixed(2)),this.cart)$(".littlePrice").eq(e).html("小计：￥"+(this.cart[e].count*this.cart[e].price).toFixed(2))}},{key:"addSubCount",value:function(){var o=this;$(".sub").on("click",function(){var e=$(this).parents(".good").data("id");console.log(e,"..."),o.cart=o.cart.map(function(t){return t.id===e&&(t.count--,t.count<=0&&(t.count=1)),t}),localStorage.setItem("cart",JSON.stringify(o.cart)),o.render(),o.calcTotalMoney()}),$(".add").on("click",function(){var e=$(this).parents(".good").data("id");console.log(e,"..."),o.cart=o.cart.map(function(t){return t.id===e&&t.count++,t}),localStorage.setItem("cart",JSON.stringify(o.cart)),o.render(),o.calcTotalMoney()}),$(".countNum").on("change",function(){var e=$(this).parents(".good").data("id");console.log("id:"+e);var c=$(this).val();console.log(e,"..."),o.cart=o.cart.map(function(t){return t.id===e&&(t.count=c-0),t}),localStorage.setItem("cart",JSON.stringify(o.cart)),o.calcTotalMoney()}),$(".del").on("click",function(){var a=$(this).parents(".good").data("id");console.log("id:",a),o.cart=o.cart.map(function(t){if(t.id===a)for(var e=JSON.parse(localStorage.getItem("cart")),c=0;c<e.length;c++)e[c].id===a&&(e.splice(c,1),0==(o.cart=e).length?localStorage.removeItem("cart"):localStorage.setItem("cart",JSON.stringify(o.cart)));return t}),o.render(),o.calcTotalMoney()}),$(".edit").on("click",function(){console.log("编辑"),$(this).parents(".good").find(".countNum").focus()})}},{key:"setAllCheckStatus",value:function(){var t=this.cart.every(function(t){return t.check});$("#checkAll").prop("checked",t)}},{key:"setCheckAll",value:function(){var t=this,a=JSON.parse(localStorage.getItem("cart"));$("#checkAll").on("change",function(){var e=this,c=this;console.log("点击了选择"),console.log(a),t.cart=t.cart.map(function(t){return t.check=e.checked,t}),localStorage.setItem("cart",JSON.stringify(t.cart)),$(".checkhh").each(function(t,e){e.checked=c.checked}),t.calcTotalMoney()})}},{key:"checksChange",value:function(){var t=this;$(".checkhh").on("change",function(){var e=this,c=$(this).parents(".good").data("id");t.cart=t.cart.map(function(t){return t.id===c&&(t.check=$(e).prop("checked")),t}),console.log(t.cart),localStorage.setItem("cart",JSON.stringify(t.cart)),t.setAllCheckStatus(),t.calcTotalMoney()})}},{key:"calSendPrice",value:function(){$(".getPrice").on("click",function(){if(0==$("#province").val()||""==$("#sendNum").val())alert("所属省或邮政编码不能为空");else{var t,e,c=$("#country").val()-0,a=$("#province").val()-0;console.log(c,a),e=1!==c?(t=30,50):1==a?(t=12,20):(t=15,25),console.log(t,e),$("#sendPrice1").html("￥"+t),$("#sendPrice2").html("￥"+e),$(".send").css("display","block")}})}}]),t}())})});