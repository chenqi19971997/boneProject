"use strict";function _classCallCheck(t,c){if(!(t instanceof c))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,c){for(var e=0;e<c.length;e++){var a=c[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,c,e){return c&&_defineProperties(t.prototype,c),e&&_defineProperties(t,e),t}require(["./config"],function(){require(["template","header","footer"],function(c,n){new(function(){function t(){_classCallCheck(this,t),this.render(),this.cart&&(this.setAllCheckStatus(),this.calcTotalMoney(),this.checksChange(),this.addSubCount(),this.setCheckAll(),this.calSendPrice())}return _createClass(t,[{key:"render",value:function(){var t=localStorage.getItem("cart");t?(this.cart=JSON.parse(t),console.log(this.cart),$("#goods").html(c("goodsTemplate",{cart:this.cart})),$(".shopping_car").css("display","block"),$(".cart-empty").css("display","none")):($(".shopping_car").css("display","none"),$(".cart-empty").css("display","block"))}},{key:"calcTotalMoney",value:function(){var t=this.cart.reduce(function(t,c){return c.check&&(t+=c.price*c.count),t},0);for(var c in $("#totalPrice1").html(t.toFixed(2)),$("#totalPrice2").html(t.toFixed(2)),this.cart)$(".littlePrice").eq(c).html("小计：￥"+(this.cart[c].count*this.cart[c].price).toFixed(2))}},{key:"addSubCount",value:function(){var o=this;console.log(this),$(".sub").on("click",function(){var c=this,e=$(this).parents(".good").data("id");console.log(e,"..."),o.cart=o.cart.map(function(t){return t.id===e&&(t.count--,t.count<=0&&(t.count=1),$(c).parents(".right1").find(".countNum").val(t.count)),t}),localStorage.setItem("cart",JSON.stringify(o.cart)),o.calcTotalMoney(),n.calcCartCount()}),$(".add").on("click",function(){var c=this,e=$(this).parents(".good").data("id");console.log(e,"..."),o.cart=o.cart.map(function(t){return t.id===e&&(t.count++,$(c).parents(".right1").find(".countNum").val(t.count)),t}),localStorage.setItem("cart",JSON.stringify(o.cart)),o.calcTotalMoney(),n.calcCartCount()}),$(".countNum").on("change",function(){var c=$(this).parents(".good").data("id");console.log("id:"+c);var e=$(this).val();console.log(c,"..."),o.cart=o.cart.map(function(t){return t.id===c&&(t.count=e-0),t}),localStorage.setItem("cart",JSON.stringify(o.cart)),$(this).parents(".right1").find(".countNum").val(e),o.calcTotalMoney(),n.calcCartCount()}),$(".del").on("click",function(){var a=$(this).parents(".good").data("id");$(this).parents(".good").css("display","none"),console.log("id:",a),o.cart=o.cart.map(function(t){if(t.id===a){var c=JSON.parse(localStorage.getItem("cart"));1==c.length&&(console.log("最后一个商品"),$(".shopping_car").css("display","none"),$(".cart-empty").css("display","block"));for(var e=0;e<c.length;e++)c[e].id===a&&(c.splice(e,1),0==(o.cart=c).length?localStorage.removeItem("cart"):localStorage.setItem("cart",JSON.stringify(o.cart)))}return t}),o.calcTotalMoney(),n.calcCartCount()}),$(".edit").on("click",function(){console.log("编辑"),$(this).parents(".good").find(".countNum").focus()})}},{key:"setAllCheckStatus",value:function(){var t=this.cart.every(function(t){return t.check});$("#checkAll").prop("checked",t)}},{key:"setCheckAll",value:function(){var t=this,a=JSON.parse(localStorage.getItem("cart"));$("#checkAll").on("change",function(){var c=this,e=this;console.log("点击了选择"),console.log(a),t.cart=t.cart.map(function(t){return t.check=c.checked,t}),localStorage.setItem("cart",JSON.stringify(t.cart)),$(".checkhh").each(function(t,c){c.checked=e.checked}),t.calcTotalMoney()})}},{key:"checksChange",value:function(){var t=this;$(".checkhh").on("change",function(){var c=this,e=$(this).parents(".good").data("id");t.cart=t.cart.map(function(t){return t.id===e&&(t.check=$(c).prop("checked")),t}),console.log(t.cart),localStorage.setItem("cart",JSON.stringify(t.cart)),t.setAllCheckStatus(),t.calcTotalMoney()})}},{key:"calSendPrice",value:function(){$(".getPrice").on("click",function(){if(0==$("#province").val()||""==$("#sendNum").val())alert("所属省或邮政编码不能为空");else{var t,c,e=$("#country").val()-0,a=$("#province").val()-0;console.log(e,a),c=1!==e?(t=30,50):1==a?(t=12,20):(t=15,25),$("#sendPrice1").html("￥"+t),$("#sendPrice2").html("￥"+c),$(".send").css("display","block")}})}}]),t}())})});