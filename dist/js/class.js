"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var l=e[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}require(["./config"],function(){require(["template","header","footer","fly","jquery","bootstrap"],function(r,n){new(function(){function e(){var t=this;_classCallCheck(this,e),this.getList().then(function(){t.addToCart(),t.myLove()})}return _createClass(e,[{key:"getList",value:function(){var n=location.search.slice(4,5)-0,c=this;return new Promise(function(o){$.get("http://www.xiongmaoyouxuan.com/api/tab/".concat(n),{start:0,sort:1},function(t){var e,i=!1;if(7==n&&(i=!0,e=decodeURIComponent(location.search.slice(12))),200===t.code){var l=t.data.items.list;l=l.filter(function(t){if(t.saleNum)return t}),i&&(l=l.filter(function(t){if(-1!==t.title.indexOf(e))return t})),console.log(l),c.detail=$.extend(!0,{},{list:l}),console.log(c.detail,444),c.changePage(),$("#list").html(r("listTemplate",{list:c.detail.list.slice(0,16)})),c.priceScreen(),c.priceFirst(),console.log(l,333),c.saleFirst(),o()}})})}},{key:"addToCart",value:function(){var n=this;$(".add").on("click",function(t){var e,i=$(this).parents(".good").find(".select").val()-0,l=$(this).parents(".good").data("id");n.fly(t,l,n.detail.list),n.detail.list.map(function(t){t.id===l&&(e=t)});var o=localStorage.getItem("cart");o?((o=JSON.parse(o)).some(function(t){return t.id===l})?o=o.map(function(t){return t.id===l&&(t.count+=i),t}):o.push({id:e.id,image:e.image,title:e.title,price:e.price,count:i}),localStorage.setItem("cart",JSON.stringify(o))):localStorage.setItem("cart",JSON.stringify([{id:e.id,image:e.image,title:e.title,price:e.price,count:i}]))})}},{key:"fly",value:function(t,e,i){var l,o=e;i.map(function(t){return t.id===o&&(l=t.image),l}),$('<img class="fly" src=\''.concat(l,"'>")).fly({start:{left:t.clientX,top:t.clientY},end:{left:$("#cart").offset().left-$(window).scrollLeft(),top:$("#cart").offset().top-$(window).scrollTop()},speed:.7,onEnd:function(){this.destroy(),n.calcCartCount()}})}},{key:"myLove",value:function(){var t=localStorage.getItem("loveList");t&&(t=JSON.parse(t)),t=(t=t.filter(function(t){return 1==t.love})).slice(0,6),$("#myLove").html(r("myLoveTemplate",{loveList:t}))}},{key:"changePage",value:function(){var t=this;this.page=1;var e=$.extend(!0,{},this.detail).list;console.log(e,9999);var i=e.filter(function(t,e){if(e/16<1)return t}),l=e.filter(function(t,e){if(1<=e/16)return t});$("#page1").on("click",function(){t.page=1,$("#list").html(r("listTemplate",{list:i})),$("html,body").scrollTop(0)}),$("#btn-class1").on("click",function(){$("#list").html(r("listTemplate",{list:i})),$("html,body").scrollTop(0)}),$("#btn-price3").on("click",function(){$("#list").html(r("listTemplate",{list:i})),$("html,body").scrollTop(0)}),$("#page2").on("click",function(){t.page=2,$("#list").html(r("listTemplate",{list:l})),$("html,body").scrollTop(0)})}},{key:"priceScreen",value:function(){console.log(this.detail,88888);var t=$.extend(!0,{},this.detail).list,e=t.filter(function(t){return t.price<=10});console.log("10元以下",e),$("#btn-price1").on("click",function(){$("#list").html(r("listTemplate",{list:e})),$("html,body").scrollTop(0)});var i=t.filter(function(t){return 10<=t.price});console.log("10元以上",i),$("#btn-price2").on("click",function(){$("#list").html(r("listTemplate",{list:i})),$("html,body").scrollTop(0)})}},{key:"priceFirst",value:function(){var t=$.extend(!0,{},this.detail).list;var l,e=(l="price",t.sort(function(t,e){var i=e[l];return t[l]-i}));console.log("价格排序后：",e),$("#btn-class2").on("click",function(){$("#list").html(r("listTemplate",{list:e})),$("html,body").scrollTop(0)})}},{key:"saleFirst",value:function(){var t=$.extend(!0,{},this.detail).list;var i,e=(i="saleNum",t.sort(function(t,e){return e[i]-t[i]}));console.log("销量排序后：",e),$("#soldList").html(r("soldListTemplate",{list0:e.slice(0,6)})),$("#btn-class3").on("click",function(){$("#list").html(r("listTemplate",{list:e})),$("html,body").scrollTop(0)})}}]),e}())})});